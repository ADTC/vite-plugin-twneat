import{a as u}from"./chunk-4VG77AZA.js";import{a as f}from"./chunk-4CY63UAA.js";import a from"fs";import{glob as d}from"glob";import g from"json5";import i from"path";function w(t){if(!t)throw new Error("twneat: twneatDir is not defined");if(!a.existsSync(t))try{a.mkdirSync(t,{recursive:!0}),console.log(`Created twneat directory: ${t}`)}catch{throw new Error(`twneat: failed to create directory: ${t}`)}}function m(t={}){let s=t.srcDir||"src",l=t.twneatDir||`${s}/twneat`,n=(r,e)=>{if(e.includes("twneat(")){let o=i.resolve(process.cwd(),l),c=i.resolve(process.cwd(),s);return y(r,c,o),!0}return!1};return[{name:"vite-plugin-twneat",enforce:"pre",buildStart:{sequential:!0,order:"pre",async handler(){console.log("\u{1F50D} twneat: Pre-processing files to generate safelist..."),w(t.twneatDir);let r=await d(`${s}/**/*.{jsx,tsx,astro,svelte,vue,js,ts,mdx,html,php,solid.js,solid.ts,component.ts,lit.js,lit.ts}`),e=0;for(let o of r)try{let c=i.resolve(process.cwd(),o),p=a.readFileSync(c,"utf-8");n(c,p)&&e++}catch(c){console.error(`twneat: Error processing file ${o}:`,c)}console.log(`\u2705 twneat: Generated safelist for ${e} files`)}},transform(r,e){if(!e.includes(i.resolve(process.cwd(),s))||(w(t.twneatDir),/\.(jsx|tsx|astro|svelte|vue|js|ts|mdx|html|php|solid\.js|solid\.ts|component\.ts|lit\.js|lit\.ts)$/.test(e)&&n(e,r)))return null}}]}function y(t,s,l){try{if(!a.existsSync(t))throw new Error(`Input file not found: ${t}`);let n=a.readFileSync(t,"utf8"),r=h(n),e=i.join(l,i.relative(s,t).replace(/[\/\\]/g,"_").replace(i.extname(t),".twneat"));a.writeFileSync(e,r,"utf8");return}catch{throw new Error(`twneat: failed to process file: ${t}`)}}function h(t){let s=/twneat\(\s*({[^}]+})\s*\)/g,n=[...t.matchAll(s)].map(e=>{try{return g.parse(e[1])}catch{throw new Error(`twneat: failed to parse: ${e[1]}`)}});if(n.length===0)return"";let r=new Set;return n.forEach(e=>{f(e).forEach(o=>r.add(o))}),Array.from(r).join(" ")}var E=m;export{E as default,h as regexExtractTwneatStrings,u as twneat};
